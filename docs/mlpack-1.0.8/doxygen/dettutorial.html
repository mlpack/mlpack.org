<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MLPACK: Density Estimation Tree (DET) tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Density Estimation Tree (DET) tutorial </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="intro_det_tut"></a>
Introduction</h2>
<p>DETs perform the unsupervised task of density estimation using decision trees. Using a trained density estimation tree (DET), the density at any particular point can be estimated very quickly (O(log n) time, where n is the number of points the tree is built on).</p>
<p>The details of this work is presented in the following paper: </p>
<div class="fragment"><pre class="fragment">@inproceedings{ram2011density,
  title={Density <a class="code" href="det_8txt.html#a65306fe60b0233b3af272883cdc54a9d">estimation</a> trees},
  author={Ram, P. and Gray, A.G.},
  booktitle={Proceedings of the 17th ACM SIGKDD International Conference on
      Knowledge Discovery and Data Mining},
  pages={627--635},
  year={2011},
  organization={ACM}
}
</pre></div><p><b>mlpack</b> provides:</p>
<ul>
<li>a <a class="el" href="dettutorial.html#cli_det_tut">simple command-line executable</a> to perform density estimation and related analyses using DETs</li>
<li>a <a class="el" href="dettutorial.html#dtree_det_tut">generic C++ class (DTree)</a> which provides various functionality for the DETs</li>
<li>a set of functions in the namespace <a class="el" href="dettutorial.html#dtutils_det_tut">mlpack::det</a> to perform cross-validation for the task of density estimation with DETs</li>
</ul>
<h2><a class="anchor" id="toc_det_tut"></a>
Table of Contents</h2>
<p>A list of all the sections this tutorial contains.</p>
<ul>
<li><a class="el" href="dettutorial.html#intro_det_tut">Introduction</a></li>
<li><a class="el" href="dettutorial.html#toc_det_tut">Table of Contents</a></li>
<li><a class="el" href="dettutorial.html#cli_det_tut">Command-Line 'det'</a><ul>
<li><a class="el" href="dettutorial.html#cli_ex1_de_tut">Plain-vanilla density estimation</a></li>
<li><a class="el" href="dettutorial.html#cli_ex2_de_test_tut">Estimation on a test set</a></li>
<li><a class="el" href="dettutorial.html#cli_ex3_de_p_tut">Printing a trained DET</a></li>
<li><a class="el" href="dettutorial.html#cli_ex4_de_vi_tut">Computing the variable importance</a></li>
<li><a class="el" href="dettutorial.html#cli_ex5_de_lm">Leaf Membership</a></li>
</ul>
</li>
<li><a class="el" href="dettutorial.html#dtree_det_tut">The 'DTree' class</a><ul>
<li><a class="el" href="dettutorial.html#dtree_pub_func_det_tut">Public Functions</a></li>
</ul>
</li>
<li><a class="el" href="dettutorial.html#dtutils_det_tut">'namespace mlpack::det'</a><ul>
<li><a class="el" href="dettutorial.html#dtutils_util_funcs">Utility Functions</a></li>
</ul>
</li>
<li><a class="el" href="dettutorial.html#further_doc_det_tut">Further Documentation</a></li>
</ul>
<h2><a class="anchor" id="cli_det_tut"></a>
Command-Line 'det'</h2>
<p>The command line arguments of this program can be viewed using the '-h' option:</p>
<div class="fragment"><pre class="fragment">$ det -h
Density Estimation With Density Estimation Trees

  This program performs a number of functions related to Density Estimation
  Trees.  The optimal Density Estimation Tree (DET) can be trained on a <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> of
  data (specified by --train_file) using cross-validation (with number of folds
  specified by --folds).  In addition, the density of a <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> of test points
  (specified by --test_file) can be estimated, and the importance of each
  dimension can be computed.  If class labels are given for the training points
  (with --labels_file), the class memberships of each leaf in the DET can be
  calculated.

  The created DET can be saved to a file, along with the density estimates for
  the test <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> and the variable importances.

Required options:

  --train_file (-t) [<span class="keywordtype">string</span>]    The data <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> on which to build a density
                                <a class="code" href="det_8txt.html#a65306fe60b0233b3af272883cdc54a9d">estimation</a> tree.

Options:

  --folds (-f) [<span class="keywordtype">int</span>]            The number of folds of cross-validation to
                                perform for the <a class="code" href="det_8txt.html#a65306fe60b0233b3af272883cdc54a9d">estimation</a> (0 is LOOCV)  Default
                                value 10.
  --help (-h)                   Default help info.
  --info [<span class="keywordtype">string</span>]               Get help on a specific module or option.
                                Default value &#39;&#39;.
  --labels_file (-l) [<span class="keywordtype">string</span>]   The labels for the given training data to
                                generate the class membership of each leaf (as
                                an extra statistic)  Default value &#39;&#39;.
  --leaf_class_table_file (-L) [<span class="keywordtype">string</span>]
                                The file in which to output the leaf class
                                membership table.  Default value
                                &#39;leaf_class_membership.txt&#39;.
  --max_leaf_size (-M) [<span class="keywordtype">int</span>]    The maximum size of a leaf in the unpruned,
                                fully grown DET.  Default value 10.
  --min_leaf_size (-N) [<span class="keywordtype">int</span>]    The minimum size of a leaf in the unpruned,
                                fully grown DET.  Default value 5.
  --print_tree (-p)             Print the tree out on the command line (or in
                                the file specified with --tree_file).
  --print_vi (-I)               Print the variable importance of each feature
                                out on the command line (or in the file
                                specified with --vi_file).
  --test_file (-T) [<span class="keywordtype">string</span>]     A <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> of test points to estimate the density of.
                                 Default value &#39;&#39;.
  --test_set_estimates_file (-E) [<span class="keywordtype">string</span>]
                                The file in which to output the estimates on the
                                test <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> from the final optimally pruned tree.
                                Default value &#39;&#39;.
  --training_set_estimates_file (-e) [<span class="keywordtype">string</span>]
                                The file in which to output the density
                                estimates on the training <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> from the final
                                optimally pruned tree.  Default value &#39;&#39;.
  --tree_file (-r) [<span class="keywordtype">string</span>]     The file in which to print the final optimally
                                pruned tree.  Default value &#39;&#39;.
  --unpruned_tree_estimates_file (-u) [<span class="keywordtype">string</span>]
                                The file in which to output the density
                                estimates on the training <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> from the large
                                unpruned tree.  Default value &#39;&#39;.
  --verbose (-v)                Display informational messages and the full list
                                of parameters and timers at the end of
                                execution.
  --vi_file (-i) [<span class="keywordtype">string</span>]       The file to output the variable importance
                                values for each feature.  Default value &#39;&#39;.

For further information, including relevant papers, citations, and theory,
consult the documentation found at http:<span class="comment">//www.mlpack.org or included with your</span>
distribution of MLPACK.
</pre></div><h3><a class="anchor" id="cli_ex1_de_tut"></a>
Plain-vanilla density estimation</h3>
<p>We can just train a DET on the provided data set <em>S</em>. Like all datasets <b>mlpack</b> uses, the data should be row-major (<b>mlpack</b> transposes data when it is loaded; internally, the data is column-major -- see <a class="el" href="matrices.html">this page</a> for more information).</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -v
</pre></div><p>By default, det performs 10-fold cross-validation (using the <img class="formulaInl" alt="$\alpha$" src="form_69.png"/>-pruning regularization for decision trees). To perform LOOCV (leave-one-out cross-validation), which can provide better results but will take longer, use the following command:</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -f 0 -v
</pre></div><p>To perform k-fold crossvalidation, use <code>-f</code> <code>k</code> (or <code>--folds</code> <code>k</code>). There are certain other options available for training. For example, in the construction of the initial tree, you can specify the maximum and minimum leaf sizes. By default, they are 10 and 5 respectively; you can set them using the <code>-M</code> (<code>--max_leaf_size</code>) and the <code>-N</code> (<code>--min_leaf_size</code>) options.</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -M 20 -N 10
</pre></div><p>In case you want to output the density estimates at the points in the training set, use the <code>-e</code> (<code>--training_set_estimates_file</code>) option to specify the output file to which the estimates will be saved. The first line in density_estimates.txt will correspond to the density at the first point in the training set. Note that the logarithm of the density estimates are given, which allows smaller estimates to be saved.</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -e density_estimates.txt -v
</pre></div><h3><a class="anchor" id="cli_ex2_de_test_tut"></a>
Estimation on a test set</h3>
<p>Often, it is useful to train a density estimation tree on a training set and then obtain density estimates from the learned estimator for a separate set of test points. The <code>-T</code> (<code>--test_file</code>) option allows specification of a set of test points, and the <code>-E</code> (<code>--test_set_estimates_file</code>) option allows specification of the file into which the test set estimates are saved. Note that the logarithm of the density estimates are saved; this allows smaller values to be saved.</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -T test_points.csv -E test_density_estimates.txt -v
</pre></div><h3><a class="anchor" id="cli_ex3_de_p_tut"></a>
Printing a trained DET</h3>
<p>A depth-first visualization of the DET can be obtained by using the <code>-p</code> (<code>--print_tree</code>) flag.</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -p -v
</pre></div><p>To print this tree in a file, use the <code>-r</code> (<code>--tree_file</code>) option to specify the output file along with the <code>-P</code> (<code>--print_tree</code>) flag.</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -p -r tree.txt -v
</pre></div><h3><a class="anchor" id="cli_ex4_de_vi_tut"></a>
Computing the variable importance</h3>
<p>The variable importance (with respect to density estimation) of the different features in the data set can be obtained by using the <code>-I</code> (<code>--print_vi</code>) option. This outputs the absolute (as opposed to relative) variable importance of the all the features.</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -I -v
</pre></div><p>To print this in a file, use the <code>-i</code> (<code>--vi_file</code>) option.</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -I -i variable_importance.txt -v
</pre></div><h3><a class="anchor" id="cli_ex5_de_lm"></a>
Leaf Membership</h3>
<p>In case the dataset is labeled and you want to find the class membership of the leaves of the tree, there is an option to print the class membership into a file. The training data has to still be input in an unlabeled format, but an additional label file containing the corresponding labels of each point has to be input using the <code>-l</code> (<code>--labels_file</code>) option. The file to output the class memberships into can be specified with <code>-L</code> (<code>--leaf_class_table_file</code>). If <code>-L</code> is left unspecified, leaf_class_membership.txt is used by default.</p>
<div class="fragment"><pre class="fragment">$ det -t dataset.csv -l labels.csv -v
$ det -t dataset.csv -l labels.csv -L leaf_class_membership_file.txt -v
</pre></div><h2><a class="anchor" id="dtree_det_tut"></a>
The 'DTree' class</h2>
<p>This class implements density estimation trees. Below is a simple example which initializes a density estimation tree.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="dtree_8hpp.html">mlpack/methods/det/dtree.hpp</a>&gt;</span>

<span class="keyword">using namespace </span>mlpack::det;

<span class="comment">// The dataset matrix, on which to learn the density estimation tree.</span>
<span class="keyword">extern</span> arma::Mat&lt;float&gt; data;

<span class="comment">// Initialize the tree.  This function also creates and saves the bounding box</span>
<span class="comment">// of the data.  Note that it does not actually build the tree.</span>
DTree&lt;&gt; det(data);
</pre></div><h3><a class="anchor" id="dtree_pub_func_det_tut"></a>
Public Functions</h3>
<p>The function <code>Grow()</code> greedily grows the tree, adding new points to the tree. Note that the points in the dataset will be reordered. This should only be run on a tree which has not already been built. In general, it is more useful to use the <code><a class="el" href="namespacemlpack_1_1det.html#ac00c29df49a801a81ad64514a9eaa3ba" title="Train the optimal decision tree using cross-validation with the given number of folds.">Trainer()</a></code> function found in <a class="el" href="dettutorial.html#dtutils_det_tut">'namespace mlpack::det'</a>.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// This keeps track of the data during the shuffle that occurs while growing the</span>
<span class="comment">// tree.</span>
arma::Col&lt;size_t&gt; oldFromNew(data.n_cols);
<span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; data.n_cols; i++)
  oldFromNew[i] = i;

<span class="comment">// This function grows the tree down to the leaves. It returns the current</span>
<span class="comment">// minimum value of the regularization parameter alpha.</span>
<span class="keywordtype">size_t</span> maxLeafSize = 10;
<span class="keywordtype">size_t</span> minLeafSize = 5;

<span class="keywordtype">double</span> <a class="code" href="det_8txt.html#ab91e75beea981a97844ff19e46d522e5">alpha</a> = det.Grow(data, oldFromNew, <span class="keyword">false</span>, maxLeafSize, minLeafSize);
</pre></div><p>Note that the alternate volume regularization should not be used (see ticket #238).</p>
<p>To estimate the density at a given query point, use the following code. Note that the logarithm of the density is returned.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// For a given query, you can obtain the density estimate.</span>
<span class="keyword">extern</span> arma::Col&lt;float&gt; query;
<span class="keyword">extern</span> DTree* det;
<span class="keywordtype">double</span> estimate = det-&gt;ComputeValue(&amp;query);
</pre></div><p>Computing the <b>variable</b> <b>importance</b> of each feature for the given DET.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// The data matrix and density estimation tree.</span>
<span class="keyword">extern</span> arma::mat data;
<span class="keyword">extern</span> DTree* det;

<span class="comment">// The variable importances will be saved into this vector.</span>
arma::Col&lt;double&gt; varImps;

<span class="comment">// You can obtain the variable importance from the current tree.</span>
det-&gt;ComputeVariableImportance(varImps);
</pre></div><h2><a class="anchor" id="dtutils_det_tut"></a>
'namespace mlpack::det'</h2>
<p>The functions in this namespace allows the user to perform tasks with the 'DTree' class. Most importantly, the <code><a class="el" href="namespacemlpack_1_1det.html#ac00c29df49a801a81ad64514a9eaa3ba" title="Train the optimal decision tree using cross-validation with the given number of folds.">Trainer()</a></code> method allows the full training of a density estimation tree with cross-validation. There are also utility functions which allow printing of leaf membership and variable importance.</p>
<h3><a class="anchor" id="dtutils_util_funcs"></a>
Utility Functions</h3>
<p>The code below details how to train a density estimation tree with cross-validation.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="dt__utils_8hpp.html">mlpack/methods/det/dt_utils.hpp</a>&gt;</span>

<span class="keyword">using namespace </span>mlpack::det;

<span class="comment">// The dataset matrix, on which to learn the density estimation tree.</span>
<span class="keyword">extern</span> arma::Mat&lt;float&gt; data;

<span class="comment">// The number of folds for cross-validation.</span>
<span class="keyword">const</span> <span class="keywordtype">size_t</span> folds = 10; <span class="comment">// Set folds = 0 for LOOCV.</span>

<span class="keyword">const</span> <span class="keywordtype">size_t</span> maxLeafSize = 10;
<span class="keyword">const</span> <span class="keywordtype">size_t</span> minLeafSize = 5;

<span class="comment">// Train the density estimation tree with cross-validation.</span>
DTree&lt;&gt;* dtree_opt = <a class="code" href="namespacemlpack_1_1det.html#ac00c29df49a801a81ad64514a9eaa3ba" title="Train the optimal decision tree using cross-validation with the given number of folds.">Trainer</a>(data, folds, <span class="keyword">false</span>, maxLeafSize, minLeafSize);
</pre></div><p>Note that the alternate volume regularization should be set to false because it has known bugs (see #238).</p>
<p>To print the class membership of leaves in the tree into a file, see the following code.</p>
<div class="fragment"><pre class="fragment"><span class="keyword">extern</span> arma::Mat&lt;size_t&gt; labels;
<span class="keyword">extern</span> DTree* det;
<span class="keyword">const</span> <span class="keywordtype">size_t</span> numClasses = 3; <span class="comment">// The number of classes must be known.</span>

<span class="keyword">extern</span> <span class="keywordtype">string</span> leafClassMembershipFile;

<a class="code" href="namespacemlpack_1_1det.html#aa47b4eeebeb1cfaec56b97a9e0f46bf5" title="Print the membership of leaves of a density estimation tree given the labels and number of classes...">PrintLeafMembership</a>(det, data, labels, numClasses, leafClassMembershipFile);
</pre></div><p>Note that you can find the number of classes with <code>max(labels)</code> <code>+</code> <code>1</code>. The variable importance can also be printed to a file in a similar manner.</p>
<div class="fragment"><pre class="fragment"><span class="keyword">extern</span> DTree* det;

<span class="keyword">extern</span> <span class="keywordtype">string</span> variableImportanceFile;
<span class="keyword">const</span> <span class="keywordtype">size_t</span> numFeatures = data.n_rows;

<a class="code" href="namespacemlpack_1_1det.html#aeee50c5f4c8d0cec3b88313e84965773" title="Print the variable importance of each dimension of a density estimation tree.">PrintVariableImportance</a>(det, numFeatures, variableImportanceFile);
</pre></div><h2><a class="anchor" id="further_doc_det_tut"></a>
Further Documentation</h2>
<p>For further documentation on the DTree class, consult the <a class="el" href="classmlpack_1_1det_1_1DTree.html">complete API documentation</a>. </p>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Aug 19 2015 16:57:28 for MLPACK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
